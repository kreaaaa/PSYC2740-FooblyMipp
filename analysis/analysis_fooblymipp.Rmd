---
title: "FM-PreRegistration"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---
# load in tidyverse
```{r}
library(tidyverse)
```

# read in data from sona and prolific
```{r}
sona_data = read.csv("../data/savic-rhyming-sona.csv") %>%
  select(-sona_id) %>% mutate(data_source = "sona")

# repeat for prolific

prolific_data = read.csv ("../data/savic-rhyming-prolific.csv") %>%
  select(-PROLIFIC_PID) %>% mutate(data_source = "prolific")

```

# bind
```{r}
##prolific_data <- prolific_data %>% select(names(sona_data))
final_data = rbind(sona_data, prolific_data) %>%
 mutate(rt = as.numeric(rt),
        relatedness = as.factor(relatedness),
        condition = as.factor(condition))%>%
  mutate(condition = fct_recode(condition, 
                                "non-rhyming" = "1",
                               "rhyming" = "2"))
```
#INSPECT DATA
 
```{r}
#number of rows and columns 
nrow(final_data)
ncol(final_data)
```
#Number of columns = 49
#Number of rows = 44306


```{r}
#unique participants and trials

final_data%>% 
group_by(ID)%>% 
count()

final_data %>% 
  filter(typeoftrial == "sentence") %>%
  group_by(ID) %>% 
  count()

final_data %>% 
  filter(typeoftrial == "attention") %>%
  group_by(ID) %>% 
  count()

final_data %>% 
  filter(typeoftrial == "target") %>%
  group_by(ID) %>% 
  count()

```
#There are 136 unique subjects.
#Subjects completed different numbers of trials because _________
# 60 sentence trials were completed all participants except 232084287, 467885230, 727137633, 869755378.		
# 9 attention check trials were completed by all participants except 232084287, 467885230, 727137633, 869755378, 
# All participants completeted 55 trials; however, these 4 subject IDs did not appear in the data because they had no target data.


# Levels of variables
```{r}
levels(final_data$condition)
levels(final_data$relatedness)
```
#Our Condition and Relatedness columns indicate our independent variable.
#Condition has 2 levels: non-rhyming and rhyming
#Relatedness has 2 levels that we are evaluating (related and unrelated). In the data it has "novel" and "" too. No target trial has "". 

#Our dependent variable columns are reaction time and correct for target trials. For our attention check and association task, we are looking at the response column. 

#for Katie. Just wanted to see generally what data looks like. not useful
```{r}
ggplot(data = final_data) +
  geom_histogram(mapping = aes (x = as.numeric(rt)))

range(as.numeric(prereg$rt))

```
#BASIC DESCRIPTIVES


```{r}
#editing all attention trials to adjust for typos

attention_trials= final_data%>% 
  filter(typeoftrial == "attention") %>% 
  select(ID, response, novel1, novel2, correct) %>% 
    rowwise() %>%
  mutate(response = ifelse(is.na(response), "blank", response)) %>%
  mutate(across(c(novel1, novel2), ~ replace_na(., "NOT_FOUND"))) %>% 
  mutate(edit_novel1 = adist(novel1, response),
         edit_novel2 = adist(novel2, response)) %>% 
  mutate(revised_correct = ifelse(edit_novel1 <= 2 |
                                    edit_novel2 <= 2,
                                    1, 0),
          mismatch = ifelse(correct == revised_correct, 0, 1)) %>%
  ungroup()
```

#general attention trials sorted by participant ID. only 1 and 4 are greater than 75%
```{r}
attention_trials  %>% 
  summarize(mean_accuracy = mean(revised_correct), 
            sd_accuracy = sd(revised_correct))

## summarize participant accuracy 
subject_attention_accuracy = attention_trials  %>% 
  group_by(ID)  %>% 
  summarize(mean_accuracy = mean(revised_correct))

# find IDs with less than 75% accuracy
low_acc_IDs = subject_attention_accuracy  %>% 
  filter(mean_accuracy < 0.75)  %>% 
  pull(ID)
```

```{r}
priming_data = final_data %>% filter(typeoftrial == "target") %>% 
  select (ID, rt, condition, relatedness, prime, response, type, correct, block_number, target, correct_key) %>% 
  filter(!is.na(rt), rt> 200, rt< 1500, correct == "true", block_number == 1) %>% 
  filter(relatedness %in% c("related", "unrelated")) %>%
  filter(!ID %in% low_acc_IDs)

```

```{r}
priming_data %>%
  group_by(condition, relatedness) %>%
  summarise(mean_rt = mean(rt)) %>%
  ggplot() +
  geom_col(mapping= aes(x= condition, y= mean_rt, 
                        group= relatedness, fill= relatedness),
           position = "dodge") +
  theme_bw() +
  scale_fill_manual(values = c("firebrick2", "lightblue"))
```

```{r}
library(lmerTest)

rt_model = lmer(data = priming_data, rt~ relatedness*condition + (1|ID))
```

```{r}
car::Anova(rt_model)
nobs(rt_model)
# load packages
check_model(rt_model)
```





